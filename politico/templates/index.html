{% extends "layout.html" %}

{% block content %}

<a href="https://github.com/sholsapp/politico">
  <img style="position: absolute; top: 0; right: 0; border: 0;"
       src="https://camo.githubusercontent.com/e7bbb0521b397edbd5fe43e7f760759336b5e05f/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677265656e5f3030373230302e706e67"
       alt="Fork me on GitHub"
       data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png"></a>

<!-- Use datamaps - https://github.com/markmarkoh/datamaps - for plotting --!>

<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<script src="{{ url_for('static', filename='js/jquery-2.1.1.js') }}"></script>
<script src="{{ url_for('static', filename='js/datamaps.usa.min.js') }}"></script>


<h1>Politico</h1>

<div class="row">
  <div id="map-div" class="col-md-4">
     <div id="map-container" style="position: relative; width: 500px; height: 300px;"></div>
  </div>
  <div id="explore-div" class="col-md-8">
    <table id="explore-table" class="table table-striped table-compact">
      <thead>
        <th>Legislator</th>
        <th>Election Year</th>
        <th>Twitter</th>
        <th>Facebook</th>
      </thead>
      <tbody>
      </tbody>
      </table>
  </div>
</div>

<script>

  function getStateLegislators(stateId) {
    $("#explore-div #explore-table tbody").html("");
    $.get("api/legislators/" + stateId,
      function(data) {
        data['legislators'].forEach(
          function(legislator) {
            console.log(JSON.stringify(legislator));
            $("#explore-div #explore-table tbody").append(
            "<tr>" +
            "<td><a href=\"" + legislator["website"] + "\">" + legislator["firstlast"] + "</a></td>" +
            "<td>" + legislator["first_elected"] + "</td>" +
            "<td>" + legislator["twitter_id"] + "</td>" +
            "<td>" + legislator["facebook_id"] + "</td>" +
            "</tr>"
            );
          });
      });
    }

    var map = new Datamap({
      element: document.getElementById('map-container'),
      scope: 'usa',
      done: function(datamap) {
        datamap.svg.selectAll('.datamaps-subunit').on('click', function(geography) {
          getStateLegislators(geography.id);
        });
      }
    });
</script>

{% endblock %}
